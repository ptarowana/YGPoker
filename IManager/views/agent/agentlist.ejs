
<head>
    
</head>


<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">에이전트 관리</a></li>
                    <li class="breadcrumb-item active">에이전트 리스트</li>
                </ol>
            </div>
            <h4 class="page-title">에이전트 리스트</h4>
        </div>
    </div>
</div>
<!-- end page title -->

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-sm-5">
                        <% if ( user.iClass == 0 ) { %>
                            <a href="javascript:BuildAgent(1);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 지사 등록</a>
                            <a href="javascript:BuildAgent(2);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 부지사 등록</a>
                            <a href="javascript:BuildAgent(3);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 총판 등록</a>
                            <a href="javascript:BuildAgent(4);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 매장 등록</a>
                        <% } else if( user.iClass == 1 ) { %>
                            <a href="javascript:BuildAgent(2);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 부지사 등록</a>
                            <a href="javascript:BuildAgent(3);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 총판 등록</a>
                            <a href="javascript:BuildAgent(4);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 매장 등록</a>
                        <% } else if( user.iClass == 2 ) { %>
                            <a href="javascript:BuildAgent(3);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 총판 등록</a>
                            <a href="javascript:BuildAgent(4);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 매장 등록</a>
                        <% } else if( user.iClass == 3 ) { %>
                            <a href="javascript:BuildAgent(4);" class="btn btn-danger mb-2"><i class="mdi mdi-plus-circle mr-2"></i> 매장 등록</a>
                        <% } %>
                    </div>
                    <br/>
                    <!-- <div class="col-sm-3">
                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btn btn-secondary active">
                                <input type="radio" name="UserTypeFilter" value="" checked />전체
                            </label>
                            <label class="btn btn-secondary">
                                <input type="radio" name="UserTypeFilter" value="NORMAL" />정상
                            </label>
                            <label class="btn btn-secondary">
                                <input type="radio" name="UserTypeFilter" value="BLOCK" />정지
                            </label>
                            <label class="btn btn-secondary">
                                <input type="radio" name="UserTypeFilter" value="QUIT" />탈퇴
                            </label>
                        </div>
                    </div> -->
                    <div class="col-sm-3">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" for="searchText">
                                    ID/이름
                                </span>
                            </div>
                            <input type="text" id="searchText" name="searchText" maxlength="20" class="form-control" />
                            <div class="input-group-append">
                                <button class="form-control" id="SearchTextFindButton">검색</button>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-3">
                        <div class="input-group mb-3">
                            <input type="text" id="iRolling" name="iRolling" maxlength="20" class="form-control" />
                            <div class="input-group-append">
                                <button class="form-control btn-primary" id="rollingChange">롤링 전환</button>
                            </div>
                        </div>
                    </div>

                    <form>
                        <div class="form-row  align-items-center">
                            <div class="col-auto">
                                <label class="col-form-label">검색일자</label>
                            </div>
                            <div class="col-auto">
                                <label class="sr-only">시작</label>
                                <input type="text" class="form-control mb-2" id="dateStart" data-provide="datepicker" placeholder="시작일">
                            </div>
                            <div class="col-auto">
                                <label class="sr-only">종료</label>
                                <input type="text" class="form-control mb-2" id="dateEnd" data-provide="datepicker" placeholder="종료일">
                            </div>
                            <div class="col-auto">
                                <button type="button" class="btn btn-primary mb-2" id="FindButton">검색</button>
                            </div>
                        </div>
                    </form>
                    <div class="col-sm-7">
                        <div class="text-sm-right">
                            <!--
                            <button type="button" class="btn btn-success mb-2 mr-1"><i class="mdi mdi-settings"></i></button>
                            <button type="button" class="btn btn-light mb-2">Export</button>
                                -->
                        </div>
                    </div><!-- end col-->
                </div>

                <div class="table-responsive">
                    <table id="user-datatable" class="table table-sm table-hover dt-responsive nowrap w-100">
                        <thead>
                            <tr>
                                <th>색인</th>
                                <th>구분</th>
                                <th>아이디</th>
                                <th>닉네임</th>
                                <th>현재보유캐시</th>
                                <th>보유롤링</th>
                                <th>입금금액</th>
                                <th>출금금액</th>
                                <th>하부베팅금액</th>
                                <th>하부당첨금액</th>
                                <th>하부보유캐시</th>
                                <th>하부보유포인트</th>
                                <th>최종접속일</th>
                                <th>등록일</th>
                                <th>동작</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div> <!-- end card-body-->
        </div> <!-- end card-->
    </div> <!-- end col -->

    <div class="modal fade task-modal-content" id="BuildAgentDialog" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="NewTaskModalLabel">에이전트 생성</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body">
                        <!-- <form class="p-2" id="UserForm" method="POST" action="/agent/register"> -->
                        <input type="hidden" name="id" id="uid" value="" />
                        <div class="form-group">
                            <label>에이전트 등급</label>
                            <select class="form-control form-control-light" name="BiClass" id="BiClass">
                                <option value="1" selected>지사</option>
                                <option value="2">부지사</option>
                                <option value="3">총판</option>
                                <option value="4">매장</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">상위 에이전트 아이디</label>
                                    <input type="text" class="form-control date" id="BstrParentID" name="BstrParentID">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">아이디</label>
                                    <div class="input-group mb-3">
                                        <input type="text" id="BstrID" name="BstrID" maxlength="20" class="form-control" />
                                        <div class="input-group-append">
                                            <button class="form-control" onclick="RequestAgentCheckID();">중복확인</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">로그인 비밀번호</label>
                                    <input type="password" class="form-control form-control-light" id="BstrPassword" name="BstrPassword" placeholder="로그인 비밀번호">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">닉네임</label>
                                    <div class="input-group mb-3">
                                        <input type="text" id="BstrNickname" name="BstrNickname" maxlength="20" class="form-control" />
                                        <div class="input-group-append">
                                            <button class="form-control" onclick="RequestAgentCheckNickname();">중복확인</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">예금주명</label>
                                    <input type="text" class="form-control date" id="BstrName" name="BstrName" placeholder="">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">은행명</label>
                                    <input type="text" class="form-control date" id="BstrDesc" name="BstrDesc" placeholder="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">계좌번호</label>
                                    <input type="text" class="form-control date" id="BstrAccount" name="BstrAccount" placeholder="">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">죽장 % </label>
                                    <input type="text" class="form-control date" id="BfSettle" name="BfSettle" placeholder="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">홀덤 딜비 %</label>
                                    <input type="text" class="form-control date" id="BfHoldemR" name="BfHoldemR" placeholder="">
                                    <small class="form-text text-muted" id = "Bholdemdeal"></small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">빅투 딜비 %</label>
                                    <input type="text" class="form-control date" id="BfBig2R" name="BfBig2R" placeholder="">
                                    <small class="form-text text-muted" id = "Bbig2deal"></small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">싯고 딜비 %</label>
                                    <input type="text" class="form-control date" id="BfSitgoR" name="BfSitgoR" placeholder="">
                                    <small class="form-text text-muted" id = "Bsitgodeal"></small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">바카라 딜비 %</label>
                                    <input type="text" class="form-control date" id="BfBaccaratR" name="BfBaccaratR" placeholder="">
                                    <small class="form-text text-muted" id = "Bbaccaratdeal"></small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">오마하 딜비 %</label>
                                    <input type="text" class="form-control date" id="BfOmahaR" name="BfOmahaR" placeholder="">
                                    <small class="form-text text-muted" id = "Bomahadeal"></small>
                                </div>
                            </div>
                        </div>

                        <div class="text-right">
                            <button type="button" class="btn btn-primary" onclick="RequestAgentRegister();">저장</button>
                            <button type="button" class="btn btn-light" data-dismiss="modal">취소</button>
                        </div>
                    <!-- </form> -->
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <div class="modal fade task-modal-content" id="AgentDialog" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="NewTaskModalLabel">에이전트 정보</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body">
                        <!-- <form class="p-2" id="UserForm" method="POST" action="/agent/register"> -->
                        <input type="hidden" name="id" id="uid" value="" />
                        <div class="form-group">
                            <label>에이전트 등급</label>
                            <select class="form-control form-control-light" name="iClass" id="iClass">
                                <option value="1" selected>지사</option>
                                <option value="2">부지사</option>
                                <option value="3">총판</option>
                                <option value="4">매장</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">상위 에이전트 아이디</label>
                                    <input type="text" class="form-control date" id="strParentID" name="strParentID">
                                </div>
                            </div>
                        </div>
                        <div class="row" id = "cashSend">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>배송 유형</label>
                                    <select class="form-control form-control-light" name="eInoutType" id="eInoutType">
                                        <option value="GIVE">지급</option>
                                        <option value="TAKE">차감</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">배송 금액</label>
                                    <div class="input-group mb-6">
                                        <input type="text" id="iInputAmount" name="iInputAmount" maxlength="20" class="form-control" value="0"/>
                                        <div class="input-group-append">
                                            <button class="form-control" onclick="RequestInout();">배송</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="task-priority2">배송 금액 설정</label>
                                <div class="text-right" style="text-align:center;">
                                    <button type="button" style="width:100px;" class="btn btn-primary" onclick="AddInput(10000);">+10,000</button>
                                    <button type="button" style="width:100px;" class="btn btn-primary" onclick="AddInput(30000);">+30,000</button>
                                    <button type="button" style="width:100px;" class="btn btn-primary" onclick="AddInput(50000);">+50,000</button>
                                    <button type="button" style="width:100px;" class="btn btn-primary" onclick="AddInput(100000);">+100,000</button>
                                    <button type="button" style="width:100px;" class="btn btn-primary" onclick="AddInput(500000);">+500,000</button>
                                    <button type="button" style="width:100px;" class="btn btn-light" onclick="AddInput(0);">정정</button>
                                </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">아이디</label>
                                    <div class="input-group mb-3">
                                        <input type="text" id="strID" name="strID" maxlength="20" class="form-control" />
                                        <div class="input-group-append">
                                            <button class="form-control" onclick="RequestCheckID();">중복확인</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">로그인 비밀번호</label>
                                    <input type="password" class="form-control form-control-light" id="strPassword" name="strPassword" placeholder="로그인 비밀번호">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="task-priority2">닉네임</label>
                                    <div class="input-group mb-3">
                                        <input type="text" id="strNickname" name="strNickname" maxlength="20" class="form-control" />
                                        <div class="input-group-append">
                                            <button class="form-control" onclick="RequestCheckNickname();">중복확인</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">예금주명</label>
                                    <input type="text" class="form-control date" id="strName" name="strName" placeholder="">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">은행명</label>
                                    <input type="text" class="form-control date" id="strDesc" name="strDesc" placeholder="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">계좌번호</label>
                                    <input type="text" class="form-control date" id="strAccount" name="strAccount" placeholder="">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">포인트</label>
                                    <input type="text" class="form-control date" id="iPoint" name="iPoint" placeholder="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">캐쉬</label>
                                    <input type="text" class="form-control date" id="iCash" name="iCash" placeholder="">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">죽장 % </label>
                                    <input type="text" class="form-control date" id="fSettle" name="fSettle" placeholder="">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">홀덤 딜비 %</label>
                                    <input type="text" class="form-control date" id="fHoldemR" name="fHoldemR" placeholder="">
                                    <small class="form-text text-muted" id = "holdemdeal"></small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">빅투 딜비 %</label>
                                    <input type="text" class="form-control date" id="fBig2R" name="fBig2R" placeholder="">
                                    <small class="form-text text-muted" id = "big2deal"></small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">싯고 딜비 %</label>
                                    <input type="text" class="form-control date" id="fSitgoR" name="fSitgoR" placeholder="">
                                    <small class="form-text text-muted" id = "sitgodeal"></small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">바카라 딜비 %</label>
                                    <input type="text" class="form-control date" id="fBaccaratR" name="fBaccaratR" placeholder="">
                                    <small class="form-text text-muted" id = "baccaratdeal"></small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="birthdatepicker">오마하 딜비 %</label>
                                    <input type="text" class="form-control date" id="fOmahaR" name="fOmahaR" placeholder="">
                                    <small class="form-text text-muted" id = "omahadeal"></small>
                                </div>
                            </div>
                        </div>

                        <div class="text-right">
                            <button type="button" class="btn btn-primary" onclick="RequestRegister();">저장</button>
                            <button type="button" class="btn btn-light" data-dismiss="modal">취소</button>
                        </div>
                    <!-- </form> -->
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div>
<!-- end row -->
<script type="text/javascript" src="js/time.js"></script>
<script type="text/javascript">

    function clearForm() {
        $('#BstrParentID').val("");
        $('#BstrID').val("");
        $('#BstrPassword').val("");
        $('#BstrNickname').val("");
        $('#BfHoldemR').val("");
        $('#BfSettle').val("");
        $('#BstrDesc').val("");
        $('#BstrName').val("");
        $('#BstrAccount').val("");
    }

    var dataTableInstance;

    $(document).ready(function(){

        $("#dateStart").datepicker({
            format: 'yyyy-mm-dd',
            language : 'kr'
        });
        $("#dateEnd").datepicker({
            format: 'yyyy-mm-dd',
            language: 'kr'
        });

        $("#dateStart").val(getTimeStamp(0));
        $("#dateEnd").val(getTimeStamp(0));

        // 새 계정 생성
        $(".CreateUserButton").click(function (e) {
            e.preventDefault();

            clearForm();
            $("#UserEditDialog").modal("show");
        });

        // 테이블의 login id 컬럼 클릭 처리
        $(document).on("click", ".UserIdPopup", function (e) {
            e.preventDefault();

            $.ajax({
                //url: "@Url.Action("QueryUser")",
                url:"/agent/request_agentdetail",
                type:"POST",
                data: {
                    strID : $(this).attr("data-id")
                },
                dataType: "json",
                success: function (obj) {
                    if (obj.result == "OK") {

                        console.log(obj.data);

                        const data = obj.data;

                        $('#iClass').val(data.iClass);
                        $('#strParentID').val(data.strParentID);
                        $('#strID').val(data.strID);
                        $('#strPassword').val(data.strPassword);
                        $('#strNickname').val(data.strNickname);
                        $('#fHoldemR').val(data.fHoldemR);
                        $('#fBig2R').val(data.fBig2R);
                        $('#fSitgoR').val(data.fSitgoR);
                        $('#fOmahaR').val(data.fOmahaR);
                        $('#fBaccaratR').val(data.fBaccaratR);
                        $('#fSettle').val(data.fSettle);
                        $('#iCash').val(data.iCash);
                        $('#iPoint').val(data.iPoint);
                        $('#strDesc').val(data.strDesc);
                        $('#strName').val(data.strName);
                        $('#strAccount').val(data.strAccount);
                        
                        $("#AgentDialog").modal("show");
                    } else {
                        alert(obj.reason);
                    }
                }, error: function () {
                    alert("조회 중 오류 발생");
                }
            });
        });

        // 결제 내역 팝업
        $("#user-datatable").on("click", ".PayHistoryButton", function (e) {
            e.preventDefault();

            var loginId = $(this).parent().parent().attr("data-loginId");

            //window.open("@Url.Action("PaymentHistory")?loginId=" + loginId, "_blank", "width = 700, height = 500");

            window.open("/account/history_cash/" + loginId, "_blank", "width = 700, height = 400");
        });

        // 포인트 내역 팝업
        $("#user-datatable").on("click", ".PointHistoryButton", function (e) {
            e.preventDefault();

            var loginId = $(this).parent().parent().attr("data-loginId");

            window.open("/account/history_point/" + loginId, "_blank", "width = 700, height = 400");
        });
        // EXP 내역 팝업
        $("#user-datatable").on("click", ".ExpHistoryButton", function (e) {
            e.preventDefault();

            var loginId = $(this).parent().parent().attr("data-loginId");
            //window.open("@Url.Action("ExpHistory")?loginId=" + loginId, "_blank", "width = 700, height = 400");
            
            window.open("/account/history_exp/" + loginId, "_blank", "width = 700, height = 400");
        });
        // 아이템 내역 팝업
        $("#user-datatable").on("click", ".ItemHistoryButton", function (e) {
            e.preventDefault();

            var loginId = $(this).parent().parent().attr("data-loginId");
            //window.open("@Url.Action("ItemHistory")?loginId=" + loginId, "_blank", "width = 700, height = 400");

            console.log(loginId);
            
        });
        // 게시글 내역 팝업
        $("#user-datatable").on("click", ".ArticlesButton", function (e) {
            e.preventDefault();

            var loginId = $(this).parent().parent().attr("data-loginId");

            console.log(loginId);
            //location.href="@Url.Action("Index", "Bulletin")?author=" + loginId;
            
        });

        // 탈퇴 버튼 클릭
        $("#user-datatable").on("click", ".QuitButton", function (e) {
            e.preventDefault();

            var id = $(this).parent().parent().attr("data-id");
            var strID = $(this).parent().parent().attr("data-loginId");

            console.log(strID);
            // var id = $(this).parent().attr("data-id");
            // var loginId = $(this).parent().attr("data-loginId");

            // console.log($(this).parent().parent());

            // //alert(id);

            //if (!confirm(loginId + "계정을 탈퇴 처리 하시겠습니까?"))
            if (!confirm(strID + "계정을 탈퇴 처리 하시겠습니까?"))
                return;

            $.ajax({
                //url: "@Url.Action("QuitUser")",
                type:"POST",
                url:"/agent/request_userleave",
                data: {
                    "id": id,
                    "strID": strID
                },
                dataType: "json",
                type: "POST",
                success: function (obj) {
                    if (obj.result == "OK") {
                        alert("탈퇴 처리되었습니다");
                        dataTableInstance.ajax.reload();
                        return;
                    } else {
                        alert(obj.reason);
                    }
                },
                error: function () {
                    alert("탈퇴 처리 요청 중 오류");
                }
            });
            
        });
        //롤링전환
        $("#rollingChange").click(function (e) {
            e.preventDefault();

            //console.log(strID);
            const iRolling = $('#iRolling').val();

            if(iRolling == null || iRolling == 0)
            {
                alert("금액을 입력해주세요.");
                return;
            }
            $.ajax({
                //url: "@Url.Action("QuitUser")",
                type:"POST",
                url:"/agent/request_rollingchange",
                data: {
                    "iRolling": iRolling,
                },
                dataType: "json",
                type: "POST",
                success: function (obj) {
                    if (obj.result == "OK") {
                        alert("정상적으로 전환 되었습니다.");
                        location.reload();
                        return;
                    } else {
                        alert(obj.reason);
                    }
                },
                error: function () {
                    alert("롤링 전환 처리 요청 중 오류");
                }
            });
        });

        // 사용자 구분
        $("input[name='UserTypeFilter']").change(function () {
            dataTableInstance.ajax.reload();
        });

        $("#SearchTextFindButton").click(function (e) {
            e.preventDefault();

            dataTableInstance.ajax.reload();
        });

        // 정보 수정 완료
        $("#UserFormSubmitButton").click(function (e) {
            e.preventDefault();

            $("#UserForm").ajaxSubmit({
                //url:"/account/user",
                dataType: "json",
                type : "POST",
                beforeSubmit: function () {

                },
                success: function (obj) {
                    if (obj.result == "OK") {
                        $("#UserEditDialog").modal("hide");
                        dataTableInstance.ajax.reload();
                        return;
                    }
                    alert(obj.reason);
                },
                error: function () {
                    alert("서버 오류");
                }
            });
        });

        dataTableInstance = $('#user-datatable').DataTable({
            "serverSide": true,
            "searching": false,
            "ajax": {
                //url: "@Url.Action("UserList")",
                url:"/agent/request_agentlist",
                "type": "POST",
                "data": function (d) {
                    return $.extend({}, d, {
                        "userTypeFilter": $("input[name='UserTypeFilter']:checked").val(),
                        "search" : $("#searchText").val(),
                        //"iClass" : 1,
                        dateStart:$('#dateStart').val(),
                        dateEnd:$('#dateEnd').val()
                    });
                }
            },
            responsive : true,
            order: [[ 1, 'asc' ]],
            columns: [

                {
                    data: "id",
                    render: function (d, t) {
                        return d;// return "<input type='checkbox' name='chk' id='chk" + d + "' value='" + d + "' /><label for='chk" + d + "'>" + d + "</label>";
                    }
                },
                {
                    data: "iClass",
                    render: function (d, t, s, m) {
                        var text = "";
                        if (d == 0)
                            text = "본사";
                        else if (d == 1)
                            text = "지사";
                        else if (d == 2)
                            text = "부지사";
                        else if (d == 3)
                            text = "총판";
                        else if (d == 4)
                            text = "매장";
                        return text;
                    }
                },
                {
                    data: "strID",
                    render: function (d) {
                        return "<a href='#' class='UserIdPopup' data-id='" + d + "'>" + d + "</a>";
                    }
                },
                { 
                    data: "strNickname" 
                },
                { 
                    data: "iMyMoney", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iMyRolling", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iInput", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iOutput", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iTotalBets", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iTotalBets", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iTotalMoney", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    }
                },
                { 
                    data: "iTotalPoint", render: function (d) {
                        let c = parseInt(d);
                        return c.toLocaleString();
                    } 
                },
                // {
                //     data: "strNickname", render: function (d, t, row) {
                //         var label = d;
                //         if (row.userType == "TEST")
                //             label = label + '<i class="far fa-grimace"></i>';
                //         else if (row.userType == "ADMIN")
                //             label += '<i class="fas fa-users-cog"></i>';
                //         return label;
                //     }
                // },
                // {
                //     data: "eStatus",
                //     render: function (d, t, s, m) {
                //         var text = "";
                //         if (d == "BLOCK")
                //             text = "잠김";
                //         else if (d == "QUIT")
                //             text = "탈퇴";
                //         else
                //             text = "정상";
                //         return text;
                //     }
                // },
                // {
                //     data:"iPoint",
                //     // data: "iPoint", render: function (d) {
                //     //     return "<a href='#' class='PointHistoryButton' title='포인트'>" + d + "</a>";
                //     // }
                // },
                // { data: "iCash" },
                // { data: "strMobileNo" },
                { 
                    data: "updatedAt", render: function (d) {
                        let date = moment(d).format('YYYY-MM-DD HH:mm:ss');
                        return date;
                    }
                },
                { 
                    data: "createdAt", render: function (d) {
                        let date = moment(d).format('YYYY-MM-DD HH:mm:ss');
                        return date;
                    }
                },
                {
                    data: null,
                    //data:"quit",
                    render: function (d, t) {
                        var html = "";
                        if(d.eStatus != "QUIT")
                        //if(d.userStatus != "QUIT")
                            html += "<a href='#' class='QuitButton' title='탈퇴'>X</a>";
                        return html;
                    }
                }
            ],
            keys: true,
            "language": {
                "paginate": {
                    "previous": "<i class='mdi mdi-chevron-left'>",
                    "next": "<i class='mdi mdi-chevron-right'>"
                },
                "info": "현재 페이지 _PAGE_/_PAGES_, 총 _TOTAL_ 건",
                "lengthMenu": "한 페이지 길이 _MENU_",
                "emptyTable": "조건에 맞는 데이터가 없습니다",
                "infoEmpty" : "표시할 데이터 없음"
            },
            "sort": false,
            "drawCallback": function () {
                $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
            },
            createdRow: function (row, data) {
                $(row).attr("data-id", data.id);
                $(row).attr("data-loginId", data.strID);
                // if (data.eStatus == "QUIT")
                //     $(row).addClass("table-dark");

                if ( data.iClass == 1 )
                {
                    $(row).attr('style', 'background-color:#f0f0f0;')
                }
                else if ( data.iClass == 2 )
                {
                    $(row).attr('style', 'background-color:#fcfcac;')                    
                }
                else if ( data.iClass == 3 )
                {
                    $(row).attr('style', 'background-color:#f9d9f9;')                    
                }
                else if ( data.iClass == 4 )
                {
                    $(row).attr('style', 'background-color:#a0f0f0;')                    
                }
            }
        });
    });

    let BuildAgent = (iClass) => {

        console.log(iClass);
        clearForm();

        $.ajax({
            url:"/agent/request_checkrolling",
            type:"POST",
            data: {
                strID:user.strID,
                iClass:iClass
            },
            dataType: "json",
            success: function (obj) {
                console.log(obj);
                if ( obj.result == 'OK' )
                {
                    $('#BuildAgentDialog').modal('show');
                    $('#Bholdemdeal').empty();
                    $('#Bbig2deal').empty();
                    $('#Bsitgodeal').empty();
                    $('#Bomahadeal').empty();
                    $('#Bbaccaratdeal').empty();
                    let tag = `${obj.data.fHoldemRMax}% ~ ${obj.data.fHoldemRMin}%까지만 조절 가능합니다.`;
                    $('#Bholdemdeal').append(tag);
                    let tag2 = `${obj.data.fBig2RMax}% ~ ${obj.data.fBig2RMin}%까지만 조절 가능합니다.`;
                    $('#Bbig2deal').append(tag2);
                    let tag3 = `${obj.data.fSitgoRMax}% ~ ${obj.data.fSitgoRMin}%까지만 조절 가능합니다.`;
                    $('#Bsitgodeal').append(tag3);
                    let tag4 = `${obj.data.fOmahaRMax}% ~ ${obj.data.fOmahaRMin}%까지만 조절 가능합니다.`;
                    $('#Bomahadeal').append(tag4);
                    let tag5 = `${obj.data.fBaccaratRMax}% ~ ${obj.data.fBaccaratRMin}%까지만 조절 가능합니다.`;
                    $('#Bbaccaratdeal').append(tag5);
                    $('#BiClass').val(iClass);
                }
                else
                {
                    alert('이미 사용중인 아이디 입니다.');
                }
            }, 
            error: function () {
                alert("조회 중 오류 발생");
            }
        });
    }

    let RequestCheckID = () => {

        const strID = $('#strID').val();

        $.ajax({
            url:"/agent/request_checkid",
            type:"POST",
            data: {
                strID :strID
            },
            dataType: "json",
            success: function (obj) {
                if ( obj.result == 'OK' )
                {
                    alert('사용 가능한 아이디 입니다.');
                }
                else
                {
                    alert('이미 사용중인 아이디 입니다.');
                }
            }, 
            error: function () {
                alert("조회 중 오류 발생");
            }
        });
    }

    let RequestAgentCheckID = () => {

    const strID = $('#BstrID').val();

    $.ajax({
        url:"/agent/request_checkid",
        type:"POST",
        data: {
            strID :strID
        },
        dataType: "json",
        success: function (obj) {
            if ( obj.result == 'OK' )
            {
                alert('사용 가능한 아이디 입니다.');
            }
            else
            {
                alert('이미 사용중인 아이디 입니다.');
            }
        }, 
        error: function () {
            alert("조회 중 오류 발생");
        }
    });
    }

    let AddInput = (iAmount) => {

        if ( iAmount == 0 )
        {
            $('#iInputAmount').val(0);
        }
        else
        {
            const value = $('#iInputAmount').val();
            let i = parseInt(value) + parseInt(iAmount);

            $('#iInputAmount').val(i);
        }
    }
    let RequestInout = () => {
        let iAmount = $('#iInputAmount').val();
        let eInoutType = $('#eInoutType').val();
        let strID = $('#strID').val();
        let strInoutType = '';

        let object = {iAmount:iAmount, eInoutType:eInoutType, strID:$('#strID').val()};
        console.log(object);
        if(eInoutType == 'GIVE')
        {
            strInoutType = '지급';
        }
        else if(eInoutType == 'TAKE')
        {
            strInoutType = '차감';
        }

        if ( iAmount <= 0 || iAmount == '' || iAmount < 0 )
        {
            alert('금액을 확인해주세요.');
            return;
        }
        const formattedAmount = Number(iAmount).toLocaleString();

        if (confirm(`${strID}에게 ${formattedAmount}원 만큼 ${strInoutType}하시겠습니까?`)) {
            $.ajax({
                url:"/inout/request_inoutgt",
                type:"POST",
                data:object,
                dataType: "json",
                success: function (obj) {
                    if ( obj.result == 'OK' )
                    {
                        alert('완료 되었습니다.');
                        location.reload();
                    }
                    else
                    {
                        if ( obj.code == 'UnknownUser' )
                        {
                            alert('없는 사용자입니다.');
                        }
                        else if ( obj.code == 'NotEnough' )
                        {
                            alert('대상의 보유금액이 부족합니다.');
                        }
                    }
                }, 
                error: function () {
                    alert("조회 중 오류 발생");
                }
            });
        }
    }

    let RequestCheckNickname = () => {

        const strNickname = $('#strNickname').val();

        $.ajax({
            url:"/agent/request_checknickname",
            type:"POST",
            data: {
                strNickname :strNickname
            },
            dataType: "json",
            success: function (obj) {
                if ( obj.result == 'OK' )
                {
                    alert('사용 가능한 닉네임 입니다.');
                }
                else
                {
                    alert('이미 사용중인 닉네임 입니다.');
                }
            }, 
            error: function () {
                alert("조회 중 오류 발생");
            }
        });
    }

    let RequestAgentCheckNickname = () => {

    const strNickname = $('#BstrNickname').val();

    $.ajax({
        url:"/agent/request_checknickname",
        type:"POST",
        data: {
            strNickname :strNickname
        },
        dataType: "json",
        success: function (obj) {
            if ( obj.result == 'OK' )
            {
                alert('사용 가능한 닉네임 입니다.');
            }
            else
            {
                alert('이미 사용중인 닉네임 입니다.');
            }
        }, 
        error: function () {
            alert("조회 중 오류 발생");
        }
    });
    }

    let RequestRegister = () => {
        
        const strID = $('#strID').val();
        const strNickname = $('#strNickname').val();
        const iClass = $('#iClass').val();
        const strParentID = $('#strParentID').val();
        const strPassword = $('#strPassword').val();
        const fSettle = $('#fSettle').val();
        const fHoldemR = $('#fHoldemR').val();
        const fBig2R = $('#fBig2R').val();
        const fSitgoR = $('#fSitgoR').val();
        const fOmahaR = $('#fOmahaR').val();
        const fBaccaratR = $('#fBaccaratR').val();
        const iPoint = $('#iPoint').val();
        const iCash = $('#iCash').val();
        const strDesc = $('#strDesc').val();
        const strName = $('#strName').val();
        const strAccount = $('#strAccount').val();

        $.ajax({
            url:"/agent/request_register",
            type:"POST",
            data: {
                strID:strID,
                iClass:iClass,
                strNickname :strNickname,
                strParentID:strParentID,
                strPassword:strPassword,
                fSettle:fSettle,
                fHoldemR:fHoldemR,
                fBig2R:fBig2R,
                fSitgoR:fSitgoR,
                fOmahaR:fOmahaR,
                fBaccaratR:fBaccaratR,
                iPoint:iPoint,
                iCash:iCash,
                strDesc:strDesc,
                strName:strName,
                strAccount:strAccount,
            },
            dataType: "json",
            success: function (obj) {
                console.log(obj);

                if ( obj.result == 'OK' )
                {
                    alert('완료 되었습니다.');
                    location.reload();
                }
                else
                {
                    if ( obj.error == 'NotExistParent' )
                    {
                        alert('상위 에이전트가 존재 하지 않습니다.');
                    }
                    else if ( obj.error == 'ExistNickname' )
                    {
                        alert('이미 사용중인 닉네임 입니다.');
                    }
                    else if ( obj.error == 'ExistHoldemR' )
                    {
                        alert(`홀덤 딜비를 최대 ${obj.fHoldemRMax} ~ 최소 ${obj.fHoldemRMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistBig2R' )
                    {
                        alert(`빅투 딜비를 최대 ${obj.fBig2RMax} ~ 최소 ${obj.fBig2RMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistSitgoR' )
                    {
                        alert(`싯고 딜비를 최대 ${obj.fSitgoRMax} ~ 최소 ${obj.fSitgoRMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistOmahaR' )
                    {
                        alert(`오마하 딜비를 최대 ${obj.fOmahaRMax} ~ 최소 ${obj.fOmahaRMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistBaccaratR' )
                    {
                        alert(`바카라 딜비를 최대 ${obj.fBaccaratRMax} ~ 최소 ${obj.fBaccaratRMin} 사이에서 입력해주세요.`);
                    }
                }
            }, 
            error: function () {
                alert("조회 중 오류 발생");
            }
        });
    }

    let RequestAgentRegister = () => {
        
        const strID = $('#BstrID').val();
        const strNickname = $('#BstrNickname').val();
        const iClass = $('#BiClass').val();
        const strParentID = $('#BstrParentID').val();
        const strPassword = $('#BstrPassword').val();
        const fSettle = $('#BfSettle').val();
        const fHoldemR = $('#BfHoldemR').val();
        const fBig2R = $('#BfBig2R').val();
        const fSitgoR = $('#BfSitgoR').val();
        const fOmahaR = $('#BfOmahaR').val();
        const fBaccaratR = $('#BfBaccaratR').val();
        const strDesc = $('#BstrDesc').val();
        const strName = $('#BstrName').val();
        const strAccount = $('#BstrAccount').val();

        $.ajax({
            url:"/agent/request_register",
            type:"POST",
            data: {
                strID:strID,
                iClass:iClass,
                strNickname :strNickname,
                strParentID:strParentID,
                strPassword:strPassword,
                fSettle:fSettle,
                fHoldemR:fHoldemR,
                fBig2R:fBig2R,
                fSitgoR:fSitgoR,
                fOmahaR:fOmahaR,
                fBaccaratR:fBaccaratR,
                strDesc:strDesc,
                strName:strName,
                strAccount:strAccount,
            },
            dataType: "json",
            success: function (obj) {
                console.log(obj);

                if ( obj.result == 'OK' )
                {
                    alert('완료 되었습니다.');
                    location.reload();
                }
                else
                {
                    if ( obj.error == 'NotExistParent' )
                    {
                        alert('상위 에이전트가 존재 하지 않습니다.');
                    }
                    else if ( obj.error == 'ExistNickname' )
                    {
                        alert('이미 사용중인 닉네임 입니다.');
                    }
                    else if ( obj.error == 'ExistHoldemR' )
                    {
                        alert(`홀덤 딜비를 최대 ${obj.fHoldemRMax} ~ 최소 ${obj.fHoldemRMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistBig2R' )
                    {
                        alert(`빅투 딜비를 최대 ${obj.fBig2RMax} ~ 최소 ${obj.fBig2RMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistSitgoR' )
                    {
                        alert(`싯고 딜비를 최대 ${obj.fSitgoRMax} ~ 최소 ${obj.fSitgoRMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistOmahaR' )
                    {
                        alert(`오마하 딜비를 최대 ${obj.fOmahaRMax} ~ 최소 ${obj.fOmahaRMin} 사이에서 입력해주세요.`);
                    }
                    else if ( obj.error == 'ExistBaccaratR' )
                    {
                        alert(`바카라 딜비를 최대 ${obj.fBaccaratRMax} ~ 최소 ${obj.fBaccaratRMin} 사이에서 입력해주세요.`);
                    }
                }
            }, 
            error: function () {
                alert("조회 중 오류 발생");
            }
        });
    }
</script>
